<!DOCTYPE html>
<html>
    <head>
        <title>遊戲主持 | 智慧語言學習 DEMO</title>
        <link rel = "stylesheet" href = "../assets/css/host.css">
        <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css?family=Tajawal" rel="stylesheet">
    </head>
    <body>
        <audio style="display:none" autoplay="autoplay" controls="controls"loop="loop" preload="auto" src="../../assets/audio/demo-music.mp3"></audio>
        <button id = "cancel" onclick = "endGame()">取消遊戲</button>
        <h2 id = "title">加入遊戲使用代號: </h2>
        <h1 id = "gamePinText"></h1>
        <textarea style = "width: 700px; height: 300px;" readonly id = 'players'></textarea>
        <br>
        <button id = 'start' onclick = "startGame()">開始遊戲</button>
        <br>
        <br>
        <script src="https://cdn.socket.io/4.3.2/socket.io.min.js"></script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src = "../assets/js/libs/jqueryLibrary.js"></script>
        <script src = "../assets/js/libs/deparam.js"></script>
        <script>
            $(document).ready(function() {
                let socket = io();
                let params = jQuery.deparam(window.location.search);
                let gamePin

                socket.on('connect', function() {
                    $('#players').val("");
                    socket.emit('host-join', params);
                });

                socket.on('showGamePin', function(data){
                    console.log('showGamePin')
                    $('#gamePinText').html(data.pin);
                    gamePin = data.pin
                });

                socket.on('updatePlayerLobby', function(data) {
                    console.log('updatePlayerLobby')

                    document.getElementById('players').value = "";
                    
                    for(let i = 0; i < data.length; i++){
                        // if (gamePin == data[i].gamePin)
                        document.getElementById('players').value += data[i].name + "\n";
                    }
                    
                });

                //Tell server to start game if button is clicked
                function startGame(){
                    socket.emit('startGame');
                }
                function endGame(){
                    window.location.href = "/";
                }

                //When server starts the game
                socket.on('gameStarted', function(id){
                    console.log('Game Started!');
                    window.location.href="/host/game/" + "?id=" + id;
                });

                socket.on('noGameFound', function(){
                    console.log('noGameFound')
                    // window.location.href = '/'; 
                });

            })

            // socket.on('connect', function() {
            //     console.log('connect')
            //     document.getElementById('players').value = "";
            //     socket.emit('host-join', params);
            // });

            // socket.on('showGamePin', function(data){
            //     console.log('showGamePin')
            //     document.getElementById('gamePinText').innerHTML = data.pin;
            //     gamePin = data.pin
            // });

            // socket.on('updatePlayerLobby', function(data) {
            //     console.log('updatePlayerLobby')

            //     document.getElementById('players').value = "";
                
            //     for(let i = 0; i < data.length; i++){
            //         // if (gamePin == data[i].gamePin)
            //         document.getElementById('players').value += data[i].name + "\n";
            //     }
                
            // });

            // //Tell server to start game if button is clicked
            // function startGame(){
            //     socket.emit('startGame');
            // }
            // function endGame(){
            //     window.location.href = "/";
            // }

            // //When server starts the game
            // socket.on('gameStarted', function(id){
            //     console.log('Game Started!');
            //     window.location.href="/host/game/" + "?id=" + id;
            // });

            // socket.on('noGameFound', function(){
            //     console.log('noGameFound')
            //     window.location.href = '../../'; //Redirect user to 'join game' page
            // });
        </script>
    </body>
</html>

